<div class="category-container" style="width:60%">
  <p class="category-description">
    If your app has experienced crashes, you can enable the crash monitoring tool to collect memory dump including
    callstack
    information to identify the root cause of the crashes. <a href=''>Learn more</a>
  </p>

  <div *ngIf="status < toolStatus.Loaded">
    <i class="fa fa-circle-o-notch fa-spin spin-icon" aria-hidden="true"></i>
    Loading...
  </div>

  <div *ngIf="status >= toolStatus.Loaded">
    <fab-pivot [selectedKey]="selectedTabKey" (onLinkClick)="changeTab($event)">
      <fab-pivot-item headerText="Configure" itemKey="0">
        <div>
          <div style="margin-top: 40px;">
            <div class="row">
              <div class="col-md-3 field-label">
                Storage account <span class="required">*</span>
                <fab-tooltip-host content="Crash monitoring data captured via this tool will be stored in this storage account" [directionalHint]="directionalHint" [tooltipOptions]="value">
                <i class="fa fa-info-circle" aria-hidden="true"></i>
              </fab-tooltip-host>
              </div>
              <div class="col-md-3">
                <fab-text-field [value]="chosenStorageAccount" disabled="true">
                </fab-text-field>
                <div class="mt-1 mb-4" (click)="toggleStorageAccountPanel()"
                  (keyup.enter)="toggleStorageAccountPanel()">
                  <a tabindex="0" aria-label="Change storage account">Change</a>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-3 field-label">
                Start time <span class="required">*</span>
                <i class="fa fa-info-circle" aria-hidden="true"></i>
              </div>
              <div class="col-md-3">
                <fab-date-picker [minDate]="minDate" [maxDate]="maxDate" placeholder="Select a date..."
                  ariaLabel="Select start date" allowTextInput="true" showMonthPickerAsOverlay="true"
                  (onSelectDate)="onSelectStartDateHandler($event)" [formatDate]="formatDate" [value]="startDate"
                  [disabled]="monitoringEnabled">
                </fab-date-picker>
                <div class="mt-1 mb-4">
                  <fab-masked-text-field maxLength="6" [(value)]="startClock" [iconProps]="{iconName: 'Clock'}"
                    [mask]="'99:99'" [maskChar]="'-'" [validateOnFocusOut]="true" [disabled]="monitoringEnabled"
                    [getErrorMessage]="getErrorMessageOnTextField">
                  </fab-masked-text-field>
                </div>
              </div>
              <div>
                (UTC)
              </div>
            </div>
            <div class="row">
              <div class="col-md-3 field-label">
                Stop time <span class="required">*</span>
                <i class="fa fa-info-circle" aria-hidden="true"></i>
              </div>
              <div class="col-md-3">
                <fab-date-picker [minDate]="minDate" [maxDate]="maxDate" placeholder="Select a date..."
                  ariaLabel="Select end date" allowTextInput="true" showMonthPickerAsOverlay="true"
                  (onSelectDate)="onSelectEndDateHandler($event)" [formatDate]="formatDate" [value]="endDate"
                  [disabled]="monitoringEnabled">
                </fab-date-picker>
                <div class="mt-1 mb-4">
                  <fab-masked-text-field maxLength="6" [(value)]="endClock" [iconProps]="{iconName: 'Clock'}"
                    [mask]="'99:99'" [maskChar]="'-'" [validateOnFocusOut]="true"
                    [getErrorMessage]="getErrorMessageOnTextField" [disabled]="monitoringEnabled">
                  </fab-masked-text-field>
                </div>
              </div>
              <div>
                (UTC)
              </div>
            </div>
            <div class="row">
              <div class="col-md-3 field-label">
                Max No. of memory dump <span class="required">*</span>
                <i class="fa fa-info-circle" aria-hidden="true"></i>
              </div>
              <div class="col-md-3">
                <fab-dropdown id="downtimeFilter" role="combobox" [options]="memoryDumpOptions"
                  [defaultSelectedKey]="selectedDumpCount" (onChange)="selectDumpCount($event)"
                  [disabled]="monitoringEnabled">
                </fab-dropdown>
              </div>
            </div>
          </div>

          <div *ngIf="status > toolStatus.Loaded && status < toolStatus.Saved">
            <i class="fa fa-circle-o-notch fa-spin spin-icon" aria-hidden="true"></i>
            Saving...
          </div>

          <div *ngIf="error">
            <strong>{{ errorMessage }}</strong>
            <div>{{ getErrorDetails() }}</div>
          </div>

          <div class="footer">
            <hr>
            <fab-primary-button contentStyle="margin-right:10px" [disabled]="monitoringEnabled"
              (onClick)="startMonitoring()">
              Start Monitoring
            </fab-primary-button>
            <fab-primary-button [disabled]="!monitoringEnabled" (onClick)="stopMonitoring()">
              Stop Monitoring
            </fab-primary-button>
            <div *ngIf="status === toolStatus.SavingCrashMonitoringSettings">
              <i class="fa fa-circle-o-notch fa-spin spin-icon" aria-hidden="true"></i>
              Saving...
            </div>
            <div class="validationError" *ngIf="validationError !==''">{{ validationError }}</div>
          </div>
        </div>
      </fab-pivot-item>
      <fab-pivot-item headerText="Analyze" itemKey="1">
        <crash-monitoring-analysis #crashMonitoringAnalysisRef [crashMonitoringSettings]="crashMonitoringSettings">
        </crash-monitoring-analysis>
      </fab-pivot-item>
    </fab-pivot>
  </div>
</div>
