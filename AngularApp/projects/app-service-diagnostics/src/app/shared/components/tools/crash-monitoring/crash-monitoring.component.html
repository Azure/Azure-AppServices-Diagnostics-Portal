<div class="category-container" style="width:60%">
  <p class="category-description">
    If your app has experienced crashes, you can enable the crash monitoring tool to collect memory dump including
    callstack
    information to identify the root cause of the crashes. Starting or stopping the monitoring will restart the app. <a
      href=''>Learn more</a>
  </p>

  <div *ngIf="status < toolStatus.Loaded">
    <i class="fa fa-circle-o-notch fa-spin spin-icon" aria-hidden="true"></i>
    Loading...
  </div>

  <div *ngIf="status >= toolStatus.Loaded" style="margin-top: 40px;">
    <collapsible-list-fabric [collapsed]="collapsed" title="Configure">
      <div header class="ml-5 mt-3 summaryText">
        <div>{{ getMonitoringSummary() }}</div>
      </div>
      <collapsible-list-item body>
        <div>
          <div class="mt-5">
            <div class="row">
              <div class="col-md-3 field-label">
                Storage account <span class="required">*</span>
                <img src="assets/img/info.svg" />
              </div>
              <div class="col-md-3">
                <span *ngIf="chosenStorageAccount"> {{ chosenStorageAccount }}
                </span>
                <div class="mt-1 mb-4" (click)="toggleStorageAccountPanel()"
                  (keyup.enter)="toggleStorageAccountPanel()">
                  <a role="button" name="Change storage account" aria-label="Change storage account">
                    {{ chosenStorageAccount ? 'Change' : 'Select' }}</a>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-3 field-label">
                Start time <span class="required">*</span>
                <img src="assets/img/info.svg" />
              </div>
              <div class="col-md-3">
                <fab-date-picker *ngIf="!monitoringEnabled" [minDate]="minDate" [maxDate]="maxDate"
                  placeholder="Select a date..." ariaLabel="Select start date" allowTextInput="true"
                  showMonthPickerAsOverlay="true" (onSelectDate)="onSelectStartDateHandler($event)"
                  [formatDate]="formatDate" [value]="startDate">
                </fab-date-picker>
                <span *ngIf="monitoringEnabled">{{ formatDateToString(startDate) }}</span>
                <div class="mt-1 mb-4">
                  <span *ngIf="monitoringEnabled">{{ startClock }}</span>
                  <fab-masked-text-field *ngIf="!monitoringEnabled" maxLength="6" [(value)]="startClock"
                    [iconProps]="{iconName: 'Clock'}" [mask]="'99:99'" [maskChar]="'-'" [validateOnFocusOut]="true"
                    [disabled]="monitoringEnabled" [getErrorMessage]="getErrorMessageOnTextField">
                  </fab-masked-text-field>
                </div>
              </div>
              <div>
                (UTC)
              </div>
            </div>
            <div class="row">
              <div class="col-md-3 field-label">
                Stop time <span class="required">*</span>
                <img src="assets/img/info.svg" />
              </div>
              <div class="col-md-3">
                <fab-date-picker *ngIf="!monitoringEnabled" [minDate]="minDate" [maxDate]="maxDate"
                  placeholder="Select a date..." ariaLabel="Select end date" allowTextInput="true"
                  showMonthPickerAsOverlay="true" (onSelectDate)="onSelectEndDateHandler($event)"
                  [formatDate]="formatDate" [value]="endDate" [disabled]="monitoringEnabled">
                </fab-date-picker>
                <span *ngIf="monitoringEnabled">{{ formatDateToString(endDate) }}</span>
                <div class="mt-1 mb-4">
                  <fab-masked-text-field *ngIf="!monitoringEnabled" maxLength="6" [(value)]="endClock"
                    [iconProps]="{iconName: 'Clock'}" [mask]="'99:99'" [maskChar]="'-'" [validateOnFocusOut]="true"
                    [getErrorMessage]="getErrorMessageOnTextField" [disabled]="monitoringEnabled">
                  </fab-masked-text-field>
                  <span *ngIf="monitoringEnabled">{{ endClock }}</span>
                </div>
              </div>
              <div>
                (UTC)
              </div>
            </div>
            <div class="row">
              <div class="col-md-3 field-label">
                Max No. of memory dump <span class="required">*</span>
                <img src="assets/img/info.svg" />
              </div>
              <div class="col-md-3">
                <fab-dropdown *ngIf="!monitoringEnabled" id="downtimeFilter" role="combobox"
                  [options]="memoryDumpOptions" [defaultSelectedKey]="selectedDumpCount"
                  (onChange)="selectDumpCount($event)" [disabled]="monitoringEnabled">
                </fab-dropdown>
                <span *ngIf="monitoringEnabled">{{ selectedDumpCount }}</span>
              </div>
            </div>
          </div>

          <div *ngIf="status > toolStatus.Loaded && status < toolStatus.Saved">
            <i class="fa fa-circle-o-notch fa-spin spin-icon" aria-hidden="true"></i>
            Saving...
          </div>

          <div *ngIf="error">
            <strong>{{ errorMessage }}</strong>
            <div>{{ getErrorDetails() }}</div>
          </div>

          <div class="mt-5">
            <fab-primary-button contentStyle="margin-right:10px" [disabled]="monitoringEnabled"
              (onClick)="startMonitoring()">
              Start monitor
            </fab-primary-button>
            <div *ngIf="status === toolStatus.SavingCrashMonitoringSettings">
              <i class="fa fa-circle-o-notch fa-spin spin-icon" aria-hidden="true"></i>
              Saving...
            </div>
            <div class="validationError" *ngIf="validationError !==''">{{ validationError }}</div>
          </div>
        </div>
      </collapsible-list-item>
    </collapsible-list-fabric>


    <crash-monitoring-analysis (settingsChanged)="monitoringSettingsChanged($event)" #crashMonitoringAnalysisRef
      [crashMonitoringSettings]="crashMonitoringSettings">
    </crash-monitoring-analysis>

  </div>
</div>