<div class="view-container">

  <ngx-smart-modal #publishModal identifier="publishModal">
    <div>
      <h4>Confirm?</h4>
      <hr style="margin-top: 10px;margin-bottom: 10px;">
      <span>Published changes will be live in Applens and App Services "Diagnose and Solve" blade for external
        customers if the detector is marked public.</span>
      <div style="width:100%;height:450px">
        <br />
        <span>Make your detector discoverable for users by adding at least 5 search terms that describe the problems your detector can solve. We have some <strong>recommendations based on the detector description you provided</strong>.</span>
        <table style="width:100%;table-layout:fixed;">
          <tr>
            <td><div class="utterancestab"><strong>Add new Search Terms from below</strong></div></td>
            <td><div class="utterancestab"><strong>Search terms already added to your detector</strong></div></td>
          </tr>
          <tr>
            <td class="utterancessection">
              <div class="utterancestabcontent">
                <div style="margin-left: 40px; margin-top: 10px;">
                  <input type="text" style="width: 90%; display: inline;border: 1px solid grey;" placeholder="Add your custom search term" (keyup.enter)="createUtterance();" [(ngModel)]="utteranceInput">
                  <span class="icon-err" [style.display]="displayError? '': 'none'" title="At least 5 characters">
                    <i class="fa fa-exclamation"></i>
                  </span>
                  <button type="button" class="btn-link" (click)="createUtterance();">
                    <i class="fa fa-plus"></i>
                  </button>
                </div>
                <div style="width: 100%;">
                  <span style="width: 100%; margin-left:40px; display:block;"><strong>Recommended Search Terms</strong></span>
                  <ul class="utteranceslist" *ngIf="recommendedUtterances.length>0">
                    <li *ngFor="let utterance of recommendedUtterances;">
                      <button type="button" class="btn-add" (click)="addUtterance(utterance)">
                        <i class="fa fa-plus"></i>
                      </button>&nbsp;&nbsp;
                      <span class="utterances-text">{{utterance.sampleUtterance.text}}</span>
                      <span *ngIf="utterance.sampleUtterance.links && utterance.sampleUtterance.links.length>0">&nbsp;[Problem Links]</span>
                      <span *ngFor="let link of utterance.sampleUtterance.links; let i=index;">
                        <a href="{{link}}" target="_blank">[{{i+1}}]</a>
                      </span>
                    </li>
                  </ul>
                  <span *ngIf="recommendedUtterances.length==0">Nothing new.</span>
                </div>
              </div>
            </td>
            <td  class="utterancessection">
              <div class="utterancestabcontent">
                <div style="width:100%;" *ngIf="allUtterances.length==0">
                  <span>No utterances added.</span>
                </div>
                <div style="width: 100%;" *ngIf="allUtterances.length>0">
                  <ul class="utteranceslist">
                    <li *ngFor="let utterance of allUtterances;">
                      <span class="utterances-text">{{utterance.text}}</span>
                      <span *ngIf="utterance.links && utterance.links.length>0">&nbsp;[Problem Links]</span>
                      <span *ngFor="let link of utterance.links; let i=index;">
                        <a href="{{link}}" target="_blank">[{{i+1}}]</a>
                      </span>
                      <i class="fa fa-trash utterancesremoveicon" (click)="removeUtterance(utterance)"></i>
                    </li>
                  </ul>
                </div>
              </div>
            </td>
          </tr>
        </table>
      </div>
      <div style="margin-top:10px;margin-bottom: 10px;position: relative;">
        <button type="button" class="btn btn-primary" (click)="publish()"
                [class.disabled]="modalPublishingButtonDisabled" style="margin-right:6px">
          {{modalPublishingButtonText}}
        </button>
        <button type="button" class="btn btn-danger" (click)="publishModal.close()">Cancel</button>
      </div>
    </div>
  </ngx-smart-modal>

  <ngx-smart-modal #packageModal identifier="packageModal" [customClass]="'package-modal'">
    <div>
      <h4>Gist Version Management</h4>
      <hr style="margin-top: 10px;margin-bottom: 10px;">

      <div class="container-fluid">
        <div class="col-md-1">
          <ng-select [items]="gists" [(ngModel)]="selectedGist"></ng-select>
        </div>
        <div class="col-md-11">
          <gist-changelist *ngIf="selectedGist" [(id)]="selectedGist"
            [(version)]="temporarySelection[selectedGist]['version']" (change)="gistVersionChange($event)">
          </gist-changelist>
        </div>
      </div>

      <div style="margin-top: 10px;margin-bottom: 10px">
        <button type="button" class="btn btn-primary" (click)="confirm()">Confirm</button>
        <button type="button" class="btn btn-danger" (click)="cancel()">Cancel</button>
      </div>
    </div>
  </ngx-smart-modal>

  <ngx-smart-modal #devModeModal identifier="devModeModal" [customClass]="'wide-modal'">
    <div class="modal-header" style="background-color: #373277; padding: 10px 15px 10px 15px">
      <h4 class="modal-title" id="myModalLabel" style="color:white">Get Developing Options</h4>
    </div>
    <div class="modal-content">
      <div id="dev-box">
        <div>
          <h4 style="font-weight: bold; color:#373277">Local Development Prerequisites</h4>
          <p>1. Make sure you have installed
            <a href="https://code.visualstudio.com/" target="_blank">Visual Studio Code</a> and <a
              href="https://marketplace.visualstudio.com/items?itemName=ms-vscode.csharp" target="_blank">C# extension
            </a> locally.</p>
          <p>2. Install
            <a href="https://nodejs.org/en/" target="_blank">Node.js
            </a> with version 8.x or later.</p>
          <p>2. Install
            <a href="https://git-scm.com/download/win" target="_blank">Git
            </a> locally.</p>
          <br>

          <h4 style="font-weight: bold; color: #373277">Local Development Instructions</h4>
          <p>1. Download local detector packages</p>
          <p>2. Extract the zip file</p>
          <p>3. Launch the startup.cmd</p>
        </div>

        <a class="custom-btn custom"
          href="https://msit.microsoftstream.com/video/a90ea3b0-55bb-4b96-a43b-a4de363e1f4a?list=studio"
          target="_blank">
          <i class="fa fa-play-circle"></i> Watch Demo Video
        </a>

        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="hiddenModal" [checked]="hideModal"
            (change)="hideModal = !hideModal">
          <label class="form-check-lable" for="hiddenModal"
            style="color:lightslategray; font-weight: 100; margin-top: 30px">Don't show this message
            automatically</label>
        </div>
        <div style="margin-top:0px;margin-bottom: 10px; padding-top: 10px; padding-bottom: 20px">
          <button type="button" class="btn"
            style="background-color: #373277; color:white; padding:0px 10px 0px 0px; margin-right: 10px; height: 35px;"
            (click)="downloadLocalDevTools()" [class.disabled]="localDevButtonDisabled">
            <img src="assets\img\Local-Dev-Logo.png"> {{localDevText}}
          </button>
          <span style="font-weight:bold">OR</span>
          <button type="button" class="btn"
            style="background-color: white; border-color: #373277; color:#373277; height: 33px; margin-left: 10px; height: 35px;"
            (click)="dismissDevModal()">Continue Online</button>
        </div>
      </div>
    </div>
  </ngx-smart-modal>

  <div *ngIf="showAlert" class="alert alert-container" [ngClass]="alertClass" role="alert">
    {{alertMessage}}
  </div>
  <loader-view *ngIf="!code" message="Starting onboarding flow ..."></loader-view>

  <div *ngIf="code" class="onboarding-container">
    <split [direction]="horizontal" gutterSize="8" gutterColor="#dff0ff">
      <split-area size="60">
        <split direction="vertical" gutterSize="8" gutterColor="rgb(249, 233, 212)">
          <split-area size="85">
            <detector-control *ngIf="mode === DevelopMode.Create || mode === DevelopMode.Edit">
            </detector-control>
            <div class="code-container-header">

              <div class="file-tab active">
                {{fileName}}
              </div>

              <div (click)="confirmPublish()" class="action-button publish-button"
                [class.disabled]="publishButtonDisabled">
                <i class="fa fa-cloud-upload"></i>
                {{publishButtonText}}
              </div>

              <div (click)="runCompilation()" class="action-button run-button"
                [ngClass]="{'disabled': runButtonDisabled }">
                <i [ngClass]="runButtonIcon"></i>
                {{runButtonText}}
              </div>

              <div (click)="getDevOptions()" *ngIf="!gistMode" class="action-button run-button"
                [ngClass]="{'disabled': localDevButtonDisabled }">
                <i [ngClass]="devOptionsIcon"></i>
                {{localDevText}}
              </div>

              <div (click)="managePackage()" class="action-button run-button">
                <i class="fa fa-cubes"></i>
                Manage Package
              </div>
            </div>

            <ngx-monaco-editor style="height:calc(100% - 100px)" [options]="editorOptions" [(ngModel)]="code">
            </ngx-monaco-editor>

          </split-area>
          <split-area size="15">
            <div class="compilation-output-container">
              <div *ngFor="let item of buildOutput" class="compilation-output">{{item}}</div>
            </div>
          </split-area>
        </split>

      </split-area>
      <split-area size="40" *ngIf="!gistMode">
        <div class="invocation-output-title-container">
          <div class="invocation-title" [ngClass]="[!showDataSources ? 'active' : '']"
            (click)="queryResponse ? showDataSources=false : false">
            Detector Output
          </div>
          <div class="invocation-title" [ngClass]="[showDataSources ? 'active' : '']"
            (click)="queryResponse ? showDataSources=true : false">
            Data Sources
          </div>
        </div>

        <div style="padding:10px">
          <detector-view *ngIf="queryResponse && !showDataSources" [detectorResponse]="queryResponse.invocationOutput"
            [startTime]="startTime" [endTime]="endTime" [error]="errorState" [showEdit]="false" [developmentMode]="true" [script]="code" [compilationPackage]="compilationPackage"></detector-view>

          <tab-data-sources *ngIf="queryResponse && showDataSources" [onboardingMode]="true"
            [detectorResponse]="queryResponse.invocationOutput">
          </tab-data-sources>
          <nav class="container">
            <a (click)="getDevOptions()" tooltip="Local VS Development" class="buttons">
              <span>
                <span class="rotate"></span>
              </span>
            </a>
          </nav>
        </div>
      </split-area>
    </split>
  </div>
</div>
